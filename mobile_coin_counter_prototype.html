<!DOCTYPE html>
<html>
<head>
  <title>Object Counter</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>
<body>
  <h2>Object Counter</h2>
  <input type="file" accept="image/*" onchange="loadImage(event)">
  <canvas id="canvas"></canvas>
  <p id="result"></p>

  <script>
    let model;

    cocoSsd.load().then(loadedModel => {
      model = loadedModel;
    });

    function loadImage(event) {
      const img = new Image();
      img.onload = () => {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img, 0, 0);

        model.detect(img).then(predictions => {
          let counts = {};
          predictions.forEach(pred => {
            ctx.beginPath();
            ctx.rect(...pred.bbox);
            ctx.lineWidth = 2;
            ctx.strokeStyle = 'red';
            ctx.stroke();
            ctx.fillStyle = 'red';
            ctx.fillText(pred.class, pred.bbox[0], pred.bbox[1] > 10 ? pred.bbox[1] - 5 : 10);

            counts[pred.class] = (counts[pred.class] || 0) + 1;
          });

          document.getElementById('result').innerText = JSON.stringify(counts, null, 2);
        });
      };
      img.src = URL.createObjectURL(event.target.files[0]);
    }
  </script>
</body>
</html>
